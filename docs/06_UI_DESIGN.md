# 06 UIデザイン仕様

旧プロジェクトにはなかった文書。タイムラインの寸法、マーカーの視覚仕様、操作仕様、配色を事前に定義し、実装時の曖昧さを排除する。

---

## 1. 全体レイアウト

### 1.1 画面構成

```
┌─────────────────────────────────────────────────────────────┐
│  Header（タイトル + ファイル操作）                    固定高さ 48px │
├─────────────────────────────────────────────────────────────┤
│  SettingsPanel（折りたたみ可能）                              │
│  ┌─ HazardLevelInput ─┐┌─ DisplayModeToggle ─┐             │
│  └────────────────────┘└─────────────────────┘             │
│  ┌─ MemoSection（折りたたみ） ──────────────────┐             │
│  │  ブキ×4  SP×4  ターゲット順  タマヒロイ  コード  │             │
│  └────────────────────────────────────────────┘             │
├─────────────────────────────────────────────────────────────┤
│  MainArea（横並び）                                          │
│  ┌─ Timeline ──────────────────────────┐┌─ Statistics ────┐ │
│  │  方面ラベル + 方面帯背景              ││  方面別統計テーブル │ │
│  │  時間軸目盛り                         ││                  │ │
│  │  A枠レーン                           ││                  │ │
│  │  B枠レーン                           ││                  │ │
│  │  （横スクロール可能）                  ││                  │ │
│  └────────────────────────────────────┘└─────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 幅の方針

- 最小ビューポート幅: 1280px
- Timeline: 残り幅を占有（flex-1）。内部コンテンツは横スクロール
- StatisticsPanel: 固定幅 280px（右側）
- 1280px 未満では横スクロールを許容

### 1.3 Settings の折りたたみ

SettingsPanel は初期状態で展開。トグルボタンで折りたたみ可能。折りたたみ時はキケン度と方面区間数のサマリーのみ表示。MemoSection はさらに独立した折りたたみ。

---

## 2. 配色

### 2.1 カラーパレット

```css
@theme {
  /* ベース */
  --color-bg: #f8fafc;           /* 全体背景 slate-50 */
  --color-surface: #ffffff;       /* カード背景 */
  --color-border: #e2e8f0;        /* 境界線 slate-200 */
  --color-text: #1e293b;          /* 本文 slate-800 */
  --color-text-muted: #64748b;    /* 補助テキスト slate-500 */

  /* 枠カラー */
  --color-slot-a: #ef4444;        /* A枠 red-500 */
  --color-slot-a-light: #fecaca;  /* A枠 淡色 red-200 */
  --color-slot-a-bg: #fef2f2;     /* A枠 背景 red-50 */
  --color-slot-b: #3b82f6;        /* B枠 blue-500 */
  --color-slot-b-light: #bfdbfe;  /* B枠 淡色 blue-200 */
  --color-slot-b-bg: #eff6ff;     /* B枠 背景 blue-50 */

  /* マーカー */
  --color-spawn: #22c55e;         /* 湧き点 green-500 */
  --color-defeat: #f97316;        /* 撃破点 orange-500 */
  --color-defeat-hover: #ea580c;  /* 撃破点ホバー orange-600 */
  --color-defeat-drag: #c2410c;   /* 撃破点ドラッグ中 orange-700 */
  --color-defeat-invalid: #a3a3a3;/* 撃破点 不正位置 neutral-400 */

  /* 方面帯（最大9区間に対応） */
  --color-dir-1: #dbeafe;         /* blue-100 */
  --color-dir-2: #fce7f3;         /* pink-100 */
  --color-dir-3: #d1fae5;         /* emerald-100 */
  --color-dir-4: #fef3c7;         /* amber-100 */
  --color-dir-5: #e0e7ff;         /* indigo-100 */
  --color-dir-6: #ffe4e6;         /* rose-100 */
  --color-dir-7: #ccfbf1;         /* teal-100 */
  --color-dir-8: #fef9c3;         /* yellow-100 */
  --color-dir-9: #f3e8ff;         /* purple-100 */

  /* リスポーン接続線 */
  --color-respawn-line: #a3a3a3;  /* neutral-400 */
  --color-spawner-decision: #facc15; /* スポナー決定マーク yellow-400 */

  /* インタラクション */
  --color-primary: #3b82f6;       /* ボタン等 blue-500 */
  --color-primary-hover: #2563eb; /* blue-600 */
  --color-danger: #ef4444;        /* 削除等 red-500 */
}
```

### 2.2 配色ルール

- A枠関連は赤系、B枠関連は青系で統一
- 湧き点（計算結果）は緑、撃破点（ユーザー操作）はオレンジ
- 方面帯は低彩度の淡色。コンテンツの可読性を妨げない
- 同名の方面は同色にマッピング（方面名→色のハッシュ、または入力順で固定）

---

## 3. タイムライン仕様

### 3.1 寸法

| 項目 | 値 | 根拠 |
|------|-----|------|
| PIXELS_PER_SECOND | 16 | 旧実装(8)の2倍。1秒あたり16pxで十分な操作精度を確保 |
| タイムライン全幅 | 1600px | 100秒 × 16px |
| 方面ラベル行高 | 32px | テキスト表示 + 編集に十分 |
| 時間軸行高 | 24px | 目盛り + ラベル |
| 枠レーン高 | 80px | マーカー + 活動期間バー + 余白 |
| マーカー直径 | 20px | クリック・ドラッグ操作に十分な大きさ |
| 活動期間バー高 | 8px | マーカーの下に配置 |
| レーン間スペース | 4px | 視覚的分離 |

タイムライン全体の高さ: 32 + 24 + 80 + 4 + 80 = 220px（B枠あり）

### 3.2 スクロール

タイムラインコンテナは `overflow-x: auto` で横スクロール可能。1280px の画面幅でも 1600px のタイムラインを操作可能にする。

垂直方向のスクロールは不要（タイムライン高さは固定）。

### 3.3 時間軸（TimeAxis）

- 左端 = 100秒（ゲーム開始）、右端 = 0秒（ゲーム終了）
- 主目盛り: 10秒ごとにラベル付き縦線
- 副目盛り: 5秒ごとに短い縦線（ラベルなし）
- 補助目盛り: 1秒ごとにドット線（最小の視覚ガイド）
- マウスホバー時: カーソル位置の秒数をリアルタイムで表示（フローティングラベル）

### 3.4 方面帯（DirectionBands）

各方面区間を全レーンにまたがる縦帯として背景描画する。

- 帯の色: `--color-dir-N` を使用（区間インデックスに対応）
- 境界: 区間境界に 1px の破線
- 透過度: 背景として 0.5〜0.7 程度。レーン内容の可読性優先

### 3.5 方面ラベル（DirectionLabels）

タイムライン上部に各方面区間の名前を表示。

- 各区間の中央にラベルを配置
- クリックでインライン編集モード（input に変化）
- 編集中: フォーカス枠表示、Enter で確定、Escape でキャンセル
- 未編集の区間はプレースホルダー（例: "方面1"）を薄色で表示

---

## 4. マーカー仕様

### 4.1 湧き点マーカー（SpawnMarker）

| 属性 | 値 |
|------|-----|
| 形状 | 円（●） |
| 直径 | 20px |
| 色 | `--color-spawn`（緑） |
| 枠線 | 2px solid、枠カラー（A枠→赤、B枠→青） |
| ラベル | 湧き時刻（秒）をマーカー上部に表示 |
| 方面表示 | マーカー下部に方面名を小さく表示 |
| 操作 | なし（読み取り専用） |

自動湧き（1体目、2体目）は同一の見た目だが、内部に "A" or "B" の枠ラベルを表示する。

### 4.2 撃破点マーカー（DefeatMarker）

| 属性 | 値 |
|------|-----|
| 形状 | 菱形（◆）または角丸四角 |
| サイズ | 20px × 20px |
| 色（通常） | `--color-defeat`（オレンジ） |
| 色（ホバー） | `--color-defeat-hover` + `cursor: grab` |
| 色（ドラッグ中） | `--color-defeat-drag` + `cursor: grabbing` + 軽い影 |
| 色（不正位置） | `--color-defeat-invalid` + 点線枠 |
| 枠線 | 2px solid、枠カラー |
| ラベル | 撃破時刻（秒）をマーカー上部に表示 |
| 操作 | ドラッグで時間移動、右クリックで削除 |

### 4.3 リスポーン接続線（RespawnConnector）

撃破点から湧き点への視覚的な接続。

```
[撃破◆] ────┬──── [◇スポナー決定] ────── [●湧き]
             │
        184F(3.07秒)              30F(0.5秒)
```

| 属性 | 値 |
|------|-----|
| 線種 | 実線（撃破→スポナー決定）+ 破線（スポナー決定→湧き） |
| 線幅 | 2px |
| 色 | `--color-respawn-line` |
| スポナー決定マーク | 小さな◇（8px）、色は `--color-spawner-decision` |
| 表示条件 | 撃破由来の湧き点のみ（自動湧きは非表示） |

### 4.4 活動期間バー（ActivePeriod）

グリルが存在している期間を枠レーンの下部にバーで表示。

| 属性 | 値 |
|------|-----|
| 高さ | 8px |
| 位置 | マーカー行の下、レーン下部 |
| 色 | 枠カラーの淡色版（A: `--color-slot-a-light`, B: `--color-slot-b-light`） |
| 角丸 | 2px |
| 範囲 | 湧き時刻（左端）→ 撃破時刻（右端）。未撃破なら0秒まで延長 |

---

## 5. 操作仕様

### 5.1 撃破点の追加

| 操作 | 動作 |
|------|------|
| レーン上でクリック | クリック位置の時刻・枠に撃破点を追加 |
| バリデーション | シミュレーション方式で妥当性を検証。不正な場合は追加しない |
| フィードバック | 追加不可の場合、カーソル位置に一時的なエラーインジケータ（赤×等、0.5秒で消失） |
| スナップ | 最小単位は1フレーム。UIの精度はPIXELS_PER_SECONDに依存 |

### 5.2 撃破点のドラッグ移動

| フェーズ | 動作 |
|---------|------|
| mousedown | ドラッグ候補として記録。移動距離カウント開始 |
| mousemove（5px未満） | まだドラッグ開始しない |
| mousemove（5px以上） | ドラッグ開始。マーカーの見た目をドラッグ状態に変更 |
| ドラッグ中 | マーカーがカーソルに追従。リアルタイムで湧き点・方面を再計算プレビュー |
| ドラッグ中 — 不正位置 | マーカーをグレー（`--color-defeat-invalid`）に変更 |
| mouseup — 正当位置 | 撃破点の時刻を確定。影響を受ける後続撃破点があれば削除 |
| mouseup — 不正位置 | 元の位置にスナップバック |
| Escape | ドラッグキャンセル、元の位置に戻る |

### 5.3 撃破点の削除

| 操作 | 動作 |
|------|------|
| 右クリック | コンテキストメニューではなく即座に削除 |
| 影響確認 | 削除により後続撃破点が不整合になる場合、それらも連動削除 |
| フィードバック | 連動削除が発生する場合、削除対象のマーカーを一瞬ハイライト（200ms）してから削除 |

### 5.4 方面名の編集

| 操作 | 動作 |
|------|------|
| 方面ラベルをクリック | ラベルが input に変化（インライン編集） |
| 入力中 | 文字入力。最大20文字 |
| Enter | 確定して表示モードに戻る |
| Escape | 編集キャンセル、元の名前に戻る |
| 外側クリック（blur） | 確定 |

### 5.5 キケン度変更時の挙動

1. 方面区間を再生成（`getDirectionSwitchTimes` で再計算）
2. 方面名: 区間数が同じなら保持、異なればデフォルト名にリセット
3. 撃破点: 全撃破点を `validateDefeatChange` で再検証。不整合の撃破点は削除
4. B枠: B枠が消滅するキケン度になった場合、B枠の撃破点を全削除

---

## 6. 統計パネル仕様

### 6.1 テーブル構成

```
┌────────┬──────────┬──────┐
│ 区間    │ 方面名    │ 数   │
├────────┼──────────┼──────┤
│ 1方面目 │ 左       │  3   │
│ 2方面目 │ 中央     │  2   │
│ 3方面目 │ 右       │  4   │
├────────┼──────────┼──────┤
│ 合計    │          │  9   │
└────────┴──────────┴──────┘
```

### 6.2 表示ルール

- 区間は時間順（1方面目 = 最初の区間 = 100秒側）
- 数が0の区間も表示する（空でないことの確認に有用）
- 合計行は太字
- 同名の方面がある場合、テーブル下部に名前別集計も表示

### 6.3 同名方面の集計

```
方面別合計:
  左: 5体（1方面目 + 4方面目）
  中央: 2体（2方面目 + 5方面目）
  右: 4体（3方面目）
```

---

## 7. 設定パネル仕様

### 7.1 キケン度入力

- スライダー（range）: 20〜333、ステップ1
- 数値入力（テキスト）: スライダーと同期
- 表示: 「キケン度: 180%」形式
- 変更時: 方面区間と撃破点の再検証が即座に実行される

### 7.2 ブキ/SP選択

- 4枠分のドロップダウン
- アイコン + テキスト表示（DisplayMode に従う）
- 未選択状態を許容（空欄）
- 選択肢はマスターデータから動的生成

### 7.3 ターゲット順

- モード切替: ブキ順 / プレイヤー順のラジオボタン
- 順序入力: ドラッグ&ドロップでの並べ替え、またはセレクトボックスでの選択

### 7.4 ファイル操作

- 「保存」ボタン: JSON をダウンロード。ファイル名は `grill-planner-{日時}.json`
- 「読込」ボタン: ファイル選択ダイアログ。JSON を読み込んで画面に反映
- エラー時: トースト風の通知でエラーメッセージ表示（3秒で自動消失）

---

## 8. レスポンシブ方針

本バージョンはデスクトップ専用。レスポンシブ対応は行わないが、以下を考慮:

- ビューポート幅 1280px 以上: 通常レイアウト
- ビューポート幅 1280px 未満: `min-width: 1280px` を設定し、ページレベルの横スクロール
- SettingsPanel の折りたたみにより、タイムライン表示領域を最大化可能

---

## 9. アニメーション

控えめなアニメーションで操作のフィードバックを強化する。

| 対象 | アニメーション | 値 |
|------|-------------|-----|
| マーカー追加 | フェードイン + スケール | 0→1, 150ms ease-out |
| マーカー削除 | フェードアウト + スケール | 1→0, 150ms ease-in |
| ドラッグ中マーカー | 影の追加 | transition: shadow 100ms |
| 折りたたみ開閉 | 高さアニメーション | 200ms ease-in-out |
| エラーインジケータ | フェードアウト | 500ms 後に消失 |
| トースト通知 | スライドイン → 自動消失 | 300ms in, 3秒表示, 300ms out |

パフォーマンスを優先し、`transform` と `opacity` のみをアニメーションする。`width`, `height`, `top`, `left` のアニメーションは避ける。
