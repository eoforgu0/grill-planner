# 03 要件定義

---

## 1. 機能要件

### FR-01: シナリオ設定

| ID | 要件 | 詳細 |
|----|------|------|
| FR-01-1 | キケン度設定 | 20%〜333%の範囲で1%刻みで設定可能 |
| FR-01-2 | 方面名設定 | 各方面切替区間に任意の方面名を割り当て可能。デフォルト名は「方面1」「方面2」等 |
| FR-01-3 | ブキ構成メモ | 4枠分のブキをドロップダウンから選択可能（計算には影響しない） |
| FR-01-4 | スペシャル構成メモ | 4枠分のスペシャルをドロップダウンから選択可能（計算には影響しない） |
| FR-01-5 | ターゲット順メモ | ブキ順またはプレイヤー順でのターゲット順序を設定可能（計算には影響しない） |
| FR-01-6 | タマヒロイメモ | タマヒロイに関する自由記述メモ（計算には影響しない） |
| FR-01-7 | シナリオコードメモ | シナリオ識別用の自由記述メモ（計算には影響しない） |
| FR-01-8 | 表示モード切替 | アイコンのみ / テキストのみ / アイコン+テキスト を切り替え可能 |

### FR-02: タイムライン操作

| ID | 要件 | 詳細 |
|----|------|------|
| FR-02-1 | 撃破点の追加 | タイムライン上のクリックで撃破点を追加。追加先の枠（A/B）はクリック位置で決定 |
| FR-02-2 | 撃破点のドラッグ移動 | 撃破点を時間軸方向にドラッグして時刻変更。移動中はリアルタイムで計算結果をプレビュー |
| FR-02-3 | 撃破点の削除 | 撃破点を右クリックまたは削除操作で削除。後続の影響を受ける撃破点も連動削除 |
| FR-02-4 | 湧き点の自動表示 | 撃破点から計算された湧き点を自動的にタイムライン上に表示 |
| FR-02-5 | 方面の可視化 | 各湧き点に対応する方面を視覚的に表示 |
| FR-02-6 | 活動期間の可視化 | グリルの存在期間（湧き→撃破）を枠ごとに明確に可視化 |
| FR-02-7 | リスポーン過程の可視化 | 撃破→スポナー決定→湧きの3段階を視覚的に識別可能に表示 |
| FR-02-8 | 方面区間の可視化 | 方面の切替タイミングと各区間を背景色等で表示 |

### FR-03: 方面設定

| ID | 要件 | 詳細 |
|----|------|------|
| FR-03-1 | 方面名の編集 | 各方面区間の名前をインラインで編集可能 |
| FR-03-2 | キケン度連動 | キケン度変更時、方面区間数が自動的に再計算される。方面名はリセットまたは可能な範囲で保持 |

### FR-04: 統計表示

| ID | 要件 | 詳細 |
|----|------|------|
| FR-04-1 | 方面別グリル数 | 各方面区間に出現するグリル数を集計・表示 |
| FR-04-2 | 合計グリル数 | 全方面の合計グリル数を表示 |
| FR-04-3 | 方面名別集計 | 同名の方面区間をまとめた合計も表示（例: "左"が2区間ある場合の合計） |

### FR-05: ファイル入出力

| ID | 要件 | 詳細 |
|----|------|------|
| FR-05-1 | JSON保存 | シナリオデータをJSON形式でファイルにエクスポート |
| FR-05-2 | JSON読込 | JSON形式のシナリオデータをインポートし、画面に反映 |
| FR-05-3 | バージョン管理 | 保存データにバージョン番号を含め、将来の形式変更に対応可能にする |
| FR-05-4 | バリデーション | 読み込み時にデータの整合性を検証し、不正データはエラーメッセージと共に拒否 |

---

## 2. 非機能要件

### NFR-01: パフォーマンス

| ID | 要件 | 基準 |
|----|------|------|
| NFR-01-1 | 初期表示 | 2秒以内にインタラクティブ状態になること |
| NFR-01-2 | 計算応答 | 撃破点の追加・移動・削除後、100ms以内に再計算結果が描画されること |
| NFR-01-3 | ドラッグ応答 | ドラッグ中のプレビュー更新が16ms（60fps）以内に完了すること |
| NFR-01-4 | ビルドサイズ | gzip後の総転送サイズが500KB以内 |

### NFR-02: 互換性

| ID | 要件 | 基準 |
|----|------|------|
| NFR-02-1 | ブラウザ | Chrome 111+, Firefox 128+, Safari 16.4+, Edge 111+ の最新安定版 |
| NFR-02-2 | 画面サイズ | デスクトップ向け。タイムラインは縦スクロールで操作 |
| NFR-02-3 | 入力デバイス | マウス+キーボード。タッチデバイスは対象外 |

### NFR-03: 品質

| ID | 要件 | 基準 |
|----|------|------|
| NFR-03-1 | 型安全性 | TypeScript strict mode、any型の使用禁止 |
| NFR-03-2 | テスト容易性 | 計算ロジック・バリデーションロジックは純粋関数として実装し、UIに依存しない単体テストが可能 |
| NFR-03-3 | アクセシビリティ | キーボード操作での基本的なナビゲーション。WAI-ARIA完全準拠は対象外 |

### NFR-04: デプロイ

| ID | 要件 | 基準 |
|----|------|------|
| NFR-04-1 | ホスティング | GitHub Pages（静的サイト） |
| NFR-04-2 | ベースパス | `/grill-planner/` 配下で動作すること |
| NFR-04-3 | オフライン | Service Worker等のオフライン対応は対象外 |

---

## 3. UI/UX要件

### UX-01: 情報の優先度

画面上で最も重要な情報とユーザーの注意を向けるべき順序を定義する。

| 優先度 | 情報 | 理由 |
|--------|------|------|
| 1（最高） | タイムライン（湧き・撃破・方面の時系列表示） | ツールのコア機能。常に視認可能であるべき |
| 2 | 統計表示（方面別グリル数） | 戦略検討の判断材料。タイムラインと同時に確認 |
| 3 | 方面設定（区間名の編集） | 初期設定後は頻繁に変更しない |
| 4 | シナリオ設定（キケン度） | 初期設定後は変更頻度が低い |
| 5（最低） | メモ情報（ブキ・SP・ターゲット順等） | 記録目的。計算には無関係 |

### UX-02: 操作フロー

ユーザーの典型的な操作フローを定義する。

**初回セットアップフロー**:
1. キケン度を設定 → 方面区間が自動生成
2. 各区間の方面名を入力
3. （任意）メモ情報を入力

**戦略検討フロー（メインループ）**:
1. タイムライン上で撃破点をクリック追加
2. 湧き時刻・方面が自動計算表示される
3. 統計で方面別の集計を確認
4. 必要に応じて撃破点をドラッグ調整 or 削除
5. 1に戻る

**共有フロー**:
1. JSON保存でエクスポート
2. ファイルを共有
3. 受け取った側がJSON読込でインポート

### UX-03: フィードバック要件

ユーザー操作に対するフィードバックを定義する。

| 操作 | フィードバック |
|------|--------------|
| タイムライン上でホバー | 現在時刻（秒）をツールチップまたはインジケータで表示 |
| 撃破可能領域でホバー | カーソル変更 + 追加可能を示す視覚フィードバック |
| 撃破不可能領域でホバー | 追加不可を示す視覚フィードバック（例: カーソル変更、色変化） |
| 撃破点をクリック追加 | 即座に湧き点・方面・統計が更新される |
| 撃破点をドラッグ中 | 移動先での湧き時刻・方面がリアルタイムプレビュー |
| 撃破点をドラッグ — 不正位置 | 不正位置であることを視覚的に明示（色変化等）。スナップバックまたは制限 |
| 撃破点を削除 | 後続の影響撃破点も同時削除される旨を表示（影響がある場合） |
| キケン度変更 | 方面区間が再生成。既存の撃破点で不整合が生じる場合は撃破点をリセット |
| JSON読込エラー | エラー内容を具体的に表示（例: 「バージョンが未対応」「キケン度が範囲外」） |

### UX-04: 制約とガードレール

| 項目 | 制約 |
|------|------|
| 撃破点の時刻 | 0.0秒〜100.0秒の範囲内。範囲外へのドラッグは境界で停止 |
| 撃破点の重複 | 同一枠・同一フレームの撃破点は許可しない |
| B枠の操作 | B枠が存在しないキケン度ではB枠への操作を無効化 |
| データ読込 | 不正なJSONは読み込まず、現在のデータを保持 |

---

## 4. 対象外の明示

以下は本バージョンでは実装しない。

- モバイル/タブレット対応
- 多言語対応（日本語のみ）
- ダークモード切替（固定テーマ）
- 複数シナリオの同時表示・比較
- Undo/Redo機能（将来の拡張候補）
- キーボードショートカットによる撃破点操作（将来の拡張候補）
- リアルタイム共同編集
- ユーザー認証・クラウド保存
