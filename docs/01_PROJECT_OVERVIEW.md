# 01 プロジェクト概要

## 1. プロジェクト名

**Grill Planner** — Splatoon 3 サーモンラン「グリル発進」乱獲戦略シミュレーター

## 2. 目的

グリル発進イベントにおいて、撃破タイミングを時系列上に配置することで、後続グリルの湧き時刻・湧き方面を自動計算し、乱獲戦略の事前検討を可能にするデスクトップ向けWebツール。

ユーザーが得られる価値:

- 撃破タイミングをドラッグ配置するだけで、次の湧き時刻と方面が即座に分かる
- 複数体先まで連鎖を可視化し、戦略全体を俯瞰できる
- JSON保存でチームと戦略を共有できる

## 3. 対象ユーザー

グリル発進の乱獲を実践・検討するプレイヤー。ゲームの基本メカニクス（グリルの挙動、枠の概念、キケン度の影響）を理解していることを前提とする。チュートリアルやゲーム解説機能は提供しない。

## 4. スコープ

### 含むもの

- シナリオ設定（キケン度、方面、ブキ/SP構成、ターゲット順等）
- タイムライン上での撃破点の配置・移動・削除
- 湧き時刻・湧き方面の自動計算と可視化
- 方面別統計の集計・表示
- シナリオのJSON保存・読み込み

### 含まないもの

- ゲームメカニクスの解説・チュートリアル
- ブキ適性評価、ステージ別戦略、役割分担等の攻略情報
- モバイル対応（将来の可能性はあるが、本バージョンでは対象外）
- ユーザー認証、サーバーサイド処理、データベース
- リアルタイム共同編集

## 5. プラットフォーム

- デスクトップブラウザ専用（Chrome, Firefox, Safari, Edge の最新安定版）
- 完全静的サイト（サーバー不要）
- GitHub Pages でホスティング

## 6. 用語集

本プロジェクト全文書で使用する用語を定義する。

| 用語 | 定義 |
|------|------|
| **グリル** | グリル発進イベントで出現する装甲戦車型オオモノシャケ |
| **グリル枠** | グリルの管理単位。A枠（1体目系列）とB枠（2体目系列）の2枠が存在する |
| **A枠** | Wave開始時（100秒）に自動で湧く1体目のグリル系列 |
| **B枠** | キケン度に応じた経過時間後に自動で湧く2体目のグリル系列 |
| **湧き / スポーン** | グリルがフィールドに出現すること |
| **撃破** | プレイヤーがグリルを倒すこと。撃破するとリスポーンが開始される |
| **リスポーン** | 撃破後、同じ枠に新たなグリルが湧くまでの過程 |
| **スポナー決定** | リスポーン過程の第1段階。撃破から184フレーム（3.07秒）後に、どの方面から湧くかが内部的に決定される |
| **湧き待機** | リスポーン過程の第2段階。スポナー決定から30フレーム（0.5秒）後に、実際にグリルが出現する |
| **フレームタイム (FrameTime)** | フレーム単位の時間表現（整数）。60fps基準。内部計算で使用する |
| **秒タイム (SecondTime)** | 秒単位の時間表現（小数）。UI表示で使用する |
| **キケン度** | ゲーム内のキケン度パラメータ（20%〜333%）。B枠開放タイミングや方面切替回数に影響する |
| **DozerIncrSecond** | キケン度依存パラメータ。B枠グリルが開放される経過秒数 |
| **WaveChangeNum** | キケン度依存パラメータ。方面切替回数の決定に使用する値 |
| **方面切替** | 一定間隔で湧き方面の区間が切り替わる仕組み。間隔 = 72 / WaveChangeNum |
| **方面設定** | 各切替区間にユーザーが割り当てた方面名（例: "左", "中央", "右"） |
| **湧き点 (SpawnPoint)** | 計算結果として生成される、グリルが湧く時刻・枠・方面の情報 |
| **撃破点 (DefeatPoint)** | ユーザーが配置する、グリルを撃破した時刻・枠の情報 |
| **シナリオ** | キケン度・方面設定・撃破点・メモ情報を含む、1つの戦略計画の全データ |
| **乱獲** | グリル発進イベントで効率的に金イクラを回収するプレイスタイル |
| **タマヒロイ** | 金イクラを自動回収するNPC（Snatcher） |

### 時間軸の方向

本プロジェクトでは、ゲーム内時間が100秒→0秒へカウントダウンする。

```
数値が大きい = 過去（ゲーム開始側）
数値が小さい = 未来（ゲーム終了側）

6000フレーム = 100秒 = ゲーム開始
0フレーム    = 0秒   = ゲーム終了

比較: 6000 > 5000 → 6000の方が過去
```

この方向性は全文書・全コードで統一する。

## 7. 旧プロジェクトからの教訓

本プロジェクトはゼロベースの再設計だが、旧実装（grill-planner_old）での経験から以下の教訓を反映する。

### 教訓1: バリデーションのタイムパラドックス

**問題**: 撃破可能性の判定を「現在のspawns」で行っていたため、新しい撃破を追加した結果spawnsが変化することを考慮できなかった。正常な撃破が拒否されたり、不正な配置が許可されたりする致命的バグ（P0）が発生し、ツールのコア機能が使用不可能になった。

**対策**: バリデーションはシミュレーション方式で設計する。仮の撃破を追加した状態でspawnsを再計算し、再計算後の状態で整合性を検証する。詳細は05_ARCHITECTURE.mdに記述する。

### 教訓2: 設計書の欠番

**問題**: 旧プロジェクトでは03_TECHNICAL_DESIGNが欠番のまま実装に入った。型定義・状態管理・アルゴリズムの設計判断が暗黙知のまま実装され、バグの発見と修正を困難にした。

**対策**: 本プロジェクトでは実装前に8文書を完備する。特に05_ARCHITECTURE.mdで型定義・アルゴリズム・状態管理を具体的なコードレベルまで設計する。

### 教訓3: 状態管理の肥大化

**問題**: `useScenarioState`フックに16個の更新関数が集中し、責務が過大だった。新機能追加時に影響範囲の把握が困難になる構造的問題があった。

**対策**: 状態管理をuseReducerベースで設計し、アクション型による明示的な状態遷移を採用する。責務に応じたカスタムフックへの分離を設計段階で行う。

### 教訓4: UI設計の不足

**問題**: タイムラインの寸法（PIXELS_PER_SECOND = 8）が小さすぎて操作しづらい、方面編集のUIが直感的でない、マーカーのドラッグとクリックの区別に苦慮する等、UI上の問題が多数あった。明確なUI設計書がないまま実装されたことが原因。

**対策**: 06_UI_DESIGN.mdで寸法・配色・インタラクション仕様を事前に定義する。操作フィードバック（ホバー、ドラッグ中、無効状態等）も明示する。

### 教訓5: 統計ロジックの境界条件

**問題**: 方面区間の判定ロジック（statistics.tsのfindIndex）が、降順ソートされたdirectionsに対して正しく区間を判定できていない可能性があった。バリデーションバグのためツール自体が使えず、十分な検証ができなかった。

**対策**: 統計集計の区間判定ロジックを02_GAME_MECHANICS.mdで明確に仕様化し、05_ARCHITECTURE.mdで正しいアルゴリズムを定義する。

## 8. 文書構成

本プロジェクトの設計書は以下の8文書で構成される。

| # | ファイル | 内容 |
|---|---------|------|
| 01 | PROJECT_OVERVIEW.md | 本書。目的・スコープ・用語集・教訓 |
| 02 | GAME_MECHANICS.md | ゲームメカニクス完全仕様。計算ロジックの唯一の根拠 |
| 03 | REQUIREMENTS.md | 機能要件・非機能要件・UI/UX方針 |
| 04 | TECH_STACK.md | 技術選定・バージョン・セットアップ・ビルド/デプロイ |
| 05 | ARCHITECTURE.md | データモデル・状態管理・アルゴリズム・コンポーネント設計 |
| 06 | UI_DESIGN.md | レイアウト・寸法・配色・操作仕様・視覚仕様 |
| 07 | IMPLEMENTATION_GUIDE.md | 実装フェーズ・ファイル別指示・落とし穴と対策 |
| 08 | DATA_SPEC.md | 静的データ形式・アイコン資産・保存フォーマット |

読む順序は番号順を推奨する。ただし実装時は07を主軸に、必要に応じて他文書を参照する形が効率的である。
